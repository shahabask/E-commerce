<%- include('../layout/header.ejs'),{admin:false} %>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>title</title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="/public/css/main.css">
  <link rel="stylesheet" href="/public/css/linearicons.css">
  <link rel="stylesheet" href="/public/css/owl.carousel.css">
  <link rel="stylesheet" href="/public/css/themify-icons.css">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <link rel="stylesheet" href="/public/css/nice-select.css">
  <link rel="stylesheet" href="/public/css/nouislider.min.css">
  <link rel="stylesheet" href="/public/css/bootstrap.css"> -->
  <script src="https://cdn.jsdelivr.net/npm/easyinvoice/dist/easyinvoice.min.js"></script>
  <style>
    body::after {
      content: "";
      background-image: url(/public/images/daniel-storek-JM-qKEd1GMI-unsplash.jpg);
      background-size: cover;
      background-position: center;
      opacity: 0.5;
      /* Adjust the opacity value as per your preference */
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

.track-order-outer{
  justify-content: center;
}
    .track-order {
  display: flex;
  justify-content: center;
  align-items: center;
}

.step {
  flex: 1;
  position: relative;
}

.step-button {
  background-color: grey;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 8px 16px;
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  opacity: 0.5;
  /* box-shadow: 0 0 6px 0 rgb(0, 128, 0,0.7); */
 
}

.step-button.active {
  background-color: green;
  box-shadow: 0 0 10px 2px rgb(0, 128, 0,0.9);
  animation: glowing 2s infinite;
  opacity: 1;
}

@keyframes glowing {
  0% {
    box-shadow: 0 0 6px 0 rgb(0, 128, 0,0.7);
  }
  50% {
    box-shadow: 0 0 10px 2px rgb(0, 128, 0,0.9);
  }
  100% {
    box-shadow: 0 0 6px 0 rgb(0, 128, 0,0.7);
  }
}

.step-line {
  /* position: absolute; */
  margin-left: 95px;
   
  top: 25%;
  left: calc(50% + 30px);
  transform: translateY(-50%);
  width: calc(100% - 100px);
  height: 4px;
  background-color: gray;
  z-index: -1;
}

.step-line.active {
  background-color: orange;
}
  </style>
  <style>
    .cancelled-div {
  position: relative;
  display: inline-block;
  background-color: red;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: glow 1s ease-in-out infinite;
}

.cross-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  font-size: 24px;
}

@keyframes glow {
  0% {
    box-shadow: 0 0 5px red;
  }
  50% {
    box-shadow: 0 0 10px red, 0 0 20px red;
  }
  100% {
    box-shadow: 0 0 5px red;
  }
}

.return-div {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 40px;
}

.u-turn-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  color: #f00;
}

.moving-line {
  position: absolute;
  top: 0;
  left: 50%;
  width: 3px;
  height: 12px;
  background-color: #000;
  animation: moving 0.8s linear infinite;
}

@keyframes moving {
  0% {
    top: 0;
  }
  50% {
    top: -4px;
  }
  100% {
    top: 0;
  }
}


  </style>
</head>

<body>

  <section class="gradient-custom mt-5">
    <div class="container py-5 ">
      <div class="row d-flex justify-content-center align-items-center ">
        <div class="col-lg-10 col-xl-8">
          <div class="card" style="border-radius: 10px;margin-top: 10vh;">
            <div class="card-body p-4 ">
              <!-- {{#each orderDetails }} --><%for(let i=0;i<order.products.length;i++){%>

              
                <div class="card shadow-0 border mb-4">
                  <div class="card-body">
                    <div class="row">

                      <div class="col-md-3">
                        <!-- <a href="/loadProductview?id={{this.id}}"> -->
                          <img src="/public/adminimage/<%=order.products[i].image%>" class="img-fluid" alt="Phone" style="height: 55px;width: 55px;"></a>
                      </div>
                      <div class="col-md-2 text-center d-flex justify-content-center my-2 align-items-center">
                        <p class="mb-0"><%=order.products[i].name%></p>
                      </div>
                      <div class="col-md-2 text-center d-flex justify-content-center my-2 align-items-center">
                        <p class=" mb-0 "><%=order.products[i].size%></p>
                      </div>
                      <div class="col-md-2 text-center d-flex justify-content-center my-2 align-items-center">
                        <p class=" mb-0 ">Qty: <%=order.products[i].quantity%></p>
                      </div>
                      <div class="col-md-2 text-center d-flex justify-content-center my-2 align-items-center">
                        <p class=" mb-0  "><%=order.products[i].price%></p>
                      </div>
                    </div>
                  </div>
                </div>
              <%}%>
              <% if (order.status[0] == 'cancelled') { %>
                <div class="cancelled-div">
                  <span class="cross-icon">&times;</span>
                </div>
              <% } %>
              <% if (order.status[0] == 'returned') { %>
                <div class="return-div">
                  <i class="bi bi-arrow-repeat u-turn-icon"></i>
                  <span class="moving-line"></span>
                </div>
              <% } %>
              
                <div class="track-order-outer">
              <div class="track-order" style="padding-left: 80px;">
                <div class="step">
                  <button class="step-button <%= order.status[0] === 'pending' ? 'active' : '' %>">
                    Ordered
                  </button>
                  <div class="step-line <%= order.status[0] === 'shipped' || order.status[0] === 'delivered' ? 'active' : '' %>"></div>
                </div>
                <div class="step">
                  <button class="step-button <%= order.status[0] === 'shipped'? 'active' : '' %>">
                    Shipping
                  </button>
                  <div class="step-line <%= order.status[0] === 'delivered' ? 'active' : '' %>"></div>
                </div>
                <div class="step">
                  <button class="step-button <%= order.status[0] === 'delivered' ? 'active' : '' %>">
                    Delivered
                  </button>
                </div>
              </div> 
            
            </div>
          </div>
          <!-- </div> -->
          <!-- In this updated code, a new section div with the class track-order is added. Inside it, there are three div elements representing each step (ordered, shipping, delivered) with corresponding headings. The active class is applied to the step heading and step line based on the order.status value. The active class is used to style the active steps with specific colors.
          
          You can adjust the styling of the active class to match your desired colors and effects. -->
          
          
          
          
          
          
          
            <div class="card-footer border-0 px-4 py-3" style="background-color: #2b2929; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
              <p style="color: rgb(252, 252, 252);">Date:<%=order.products[0].orderDate.toLocaleDateString()%></p>
              <p style="color: rgb(252, 252, 252);">
                <%=order.products[0].address%>
                <!-- Address:{{address.houseName}},{{address.landmark}}<br>{{address.location}},{{address.pincode}},{{address.district}},{{address.state}},{{address.country}} -->
              </p>
              
              <%if(returnStatus&&order.products[0].status!="return-requested"&&order.products[0].status!="returned"&&order.products[0].status!="cancelled"&&order.products[0].status!='request-denied'){%>

              <div class="d-flex align-items-start">
                <a class="btn btn-warning return-button" data-bs-orderid="<%=order.products[0]._id%>"  data-bs-toggle="modal" data-bs-target="#returnProduct">Return Order</a>
            </div>
            <%}else if(order.products[0].status=="return-requested"){%>
              <div class="d-flex align-items-start">
                <p style="color: aqua;">Return Requested, Want To Approve</p> 
              </div> 
              <%}else if(order.products[0].status=="returned"){%>
                <div class="d-flex align-items-start">
                  <p style="color: rgb(44, 223, 71);">Successfully Returned</p> 
                </div> 
                <%}else if(order.products[0].status=="cancelled"){%>
                  <div class="d-flex align-items-start">
                    <p style="color: red;">Order Cancelled</p> 
                  </div>
                  <%}else if(order.products[0].status=="request-denied"){%>
                    <div class="d-flex align-items-start">
                      <p style="color: rgb(250, 69, 69);"> Your Return Request Has Been Denied,
                        <br>
                        You Can't Return Your Order,
                        <br>
                       <span style="color: #fff;"> For Furthermore Queries Contact Us.</span></p> 
                    </div>
            <%}else{%>
              <div class="d-flex align-items-start">
              <p style="color: red;font-weight: 300;">Order Cannot Be Returned After 7 Days. Sorry..</p> 
            </div> 
            <%}%>
              <!-- {{!-- <p style="color: rgb(252, 252, 252);">type:{{address.type}}</p> --}} -->
              <h5 class="d-flex align-items-center justify-content-end text-white text-uppercase mb-0">Total: <span class="h2 mb-0 ms-2">&#8377; <%=order.products[0].grandTotal%></span></h5>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="modal fade" id="returnProduct" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Reason for returning</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form action="/return-order" method="post">
              <input type="hidden" name="orderId" id="idField">
              <label for="reason">Your Reason:</label>
              <input type="text" class="form-control my-2" id="reason" name="reason" placeholder="Enter your reason here" required>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Return</button>
        </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.7.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.all.min.js"></script>
  <script src="https://kit.fontawesome.com/911ceacc93.js" crossorigin="anonymous"></script>
  <script src="/public/js/vendor/jquery-2.2.4.min.js"></script>

  <script src="/public/js/vendor/bootstrap.min.js"></script>
  <script src="/public/js/jquery.ajaxchimp.min.js"></script>
  <script src="/public/js/jquery.nice-select.min.js"></script>
  <script src="/public/js/jquery.sticky.js"></script>
  <script src="/public/js/nouislider.min.js"></script>
  <script src="/public/js/jquery.magnific-popup.min.js"></script>
  <script src="/public/js/owl.carousel.min.js"></script>
  <!--gmaps Js-->
  <script src="/public/js/gmaps.min.js"></script>
  <script src="/public/js/main.js"></script>

  <script>
    const invoiceGenerate = () => {
      const order = JSON.parse(decodeURIComponent('{{orderDetails1}}'));
      const address = JSON.parse(decodeURIComponent('{{addressinvoice}}'));
      const total = JSON.parse(decodeURIComponent('{{totalforinvoice}}'));
      const invoicedate = JSON.parse(decodeURIComponent('{{dateoforder}}'));
      const deliveryDate = JSON.parse(decodeURIComponent('{{deliveryDate}}'));
      const basic = JSON.parse(decodeURIComponent('{{basic}}'))
      console.log(basic)
      let invoiceProducts = [];
      for (let i = 0; i < order.length; i++) {
        invoiceProducts.push({
          quantity: order[i].quantity,
          description: order[i].name,
          'tax-rate': 0.00,
          price: order[i].price,
        });
      }

      var data = {

        // Customize enables you to provide your own templates
        // Please review the documentation for instructions and examples
        "customize": {
          //  "template": fs.readFileSync('template.html', 'base64') // Must be base64 encoded html 
        },
        "images": {
          // The logo on top of your invoice
          "logo": "https://public.easyinvoice.cloud/img/logo_en_original.png",
          // The invoice background
          "background": "https://public.easyinvoice.cloud/img/watermark-draft.jpg"
        },
        "sender": {
          "company": "Fine Bonito",
          "address": "Federal Heights, Aluva",
          "zip": "683511",
          "city": "Aluva",
          "country": "India"
        },
        "client": {
          "company": basic.username,
          'phone': basic.phone[0],
          'email': basic.email,
          "address": address.houseName,
          'location': address.location,
          "zip": address.pincode,
          "city": address.district,
          "country": address.country
        },
        "information": {
          "number": basic._id,
          "date": basic.dateOrdered,


        },
        "products": invoiceProducts,
        "bottomNotice": "Thanks for purchasing from us..",
        "currency": "INR"
      };

      // Create your invoice using EasyInvoice
      easyinvoice.createInvoice(data, function(result) {
        // The response will contain a base64 encoded PDF file
        console.log('PDF base64 string:', result.pdf);
        var base64Data = result.pdf;

        // Convert the base64 data to a Blob object
        var byteCharacters = atob(base64Data);
        var byteNumbers = new Array(byteCharacters.length);
        for (var i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        var byteArray = new Uint8Array(byteNumbers);
        var blob = new Blob([byteArray], {
          type: 'application/pdf'
        });

        // Create a temporary download link and trigger the download
        var link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'invoice.pdf';
        link.click();
      });
    }
  </script>
<script>
  var buttonFields = document.querySelectorAll('.return-button')
  buttonFields.forEach((button)=>{
      button.addEventListener('click',()=>{
          var orderid = button.getAttribute('data-bs-orderid')
          var modalField = document.getElementById('idField')
          modalField.value = orderid
      })
  })
  $ajax:{}
</script>
  <script src="https://unpkg.com/easyinvoice/dist/easyinvoice.min.js"></script>
</body>

</html>