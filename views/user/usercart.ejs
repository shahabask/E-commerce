      <%- include('../layout/header.ejs',{admin:false}) %>
      <meta charset="UTF-8">
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <style>
        body {
          background-color: #f8f9fa;
          color: #000;
          margin-top: 150px;
        }

        .cart-container {
          max-width: 900px;
          margin: 50px auto; 
          padding: 20px;
          background-color: #fff;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);


        }

        .cart-item {
          display: flex;
          padding: 20px;
          border-bottom: 1px solid #ddd;
        }

        .cart-item img {
          max-width: 100px;
          height: auto;
          margin-right: 20px;
        }

        .cart-item-details {
          flex-grow: 1;
        }

        .cart-item-title {
          font-size: 18px;
          font-weight: bold;
          margin-bottom: 10px;
        }

        .cart-item-price {
          font-size: 16px;
          color: #B12704;
          margin-bottom: 10px;
        }

        .quantity {
          display: flex;
          align-items: center;
          margin-bottom: 10px;
        }

        .quantity-btn {
          background-color: #f0c14b;
          color: #111;
          border: none;
          padding: 5px 10px;
          border-radius: 2px;
          cursor: pointer;
        }

        .remove-btn {
          background-color: #fcb20a;
          color: #000;
          border: none;
          padding: 5px 10px;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.3s ease;
        }

        .remove-btn:hover {
          background-color: #e69500;
        }

        /* Special effect for table rows */
        .table tbody tr:hover {
          background-color: rgba(0, 0, 0, 0.05);
          transition: background-color 0.3s ease;
        }

        .step-item.active {
          color: #fcb20a;
          font-weight: bold;
        }

        /* Special effect for completed steps */
        .step-item.completed {
          color: #4caf50;
        }

        /* Circle styles */
        .step-circle {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background-color: #1a237e;
          color: #fff;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          position: relative;
          z-index: 1;
          margin-bottom: 10px;
          margin-left: 15px;
        }

        /* Line styles */
        .step-line {
          width: 2px;
          background-color: #1a237e;
          position: absolute;
          top: 20px;
          left: 19px;
          z-index: 0;
        }

        .step-line:first-child {
          top: 0;
        }

        .step-line:last-child {
          height: 20px;
        }

        /* Special effect for motion effect */
        .motion-effect {
          animation-name: motion;
          animation-duration: 1s;
          animation-iteration-count: infinite;
          animation-direction: alternate;
        }

        @keyframes motion {
          0% {
            transform: translateY(0);
          }

          100% {
            transform: translateY(-10px);
          }
        }

        .total-container {
          max-width: 900px;
          /* Increase the max-width value */
          margin: 0 auto;
          padding: 20px;
          background-color: #f8f9fa;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
          margin-top: 100px;
          /* margin-left: 60px;  */
        }

        .invoice-heading {
          font-size: 24px;
          font-weight: bold;
          margin-bottom: 20px;
        }

        .invoice-details {
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        }

        .invoice-details span {
          font-weight: bold;
        }

        /* Coupon form styles */
        .coupon-form {
          margin-top: 20px;
          padding: 20px;
          background-color: #f8f9fa;
          border-radius: 5px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .coupon-field {
          display: flex;
          align-items: center;
        }

        .coupon-input {
          flex: 1;
          padding: 5px;
          border: 1px solid #ccc;
          border-radius: 5px;
          margin-right: 10px;
        }

        .apply-btn {
          background-color: #1a237e;
          color: #fff;
          border: none;
          padding: 5px 10px;
          border-radius: 5px;
          cursor: pointer;
        }

        .message {
          color: red;
          margin-top: 5px;
        }

        #grandTotal {
          font-family: Arial, sans-serif;
          /* Use a font that supports the rupee symbol */
        }
        @media (max-width: 576px) {
  .table-container {
    overflow-x: auto;
  }

}
.cssbuttons-io-button {
  background: green;
  color: white;
  font-family: inherit;
  padding: 0.35em;
  padding-left: 1.2em;
  font-size: 17px;
  font-weight: 500;
  border-radius: 0.3em;
  border: none;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  box-shadow: inset 0 0 1.6em -0.6em #edcbd7;
  overflow: hidden;
  position: relative;
  height: 2.2em;
  padding-right: 3.3em;
}

.cssbuttons-io-button .icon {
  background: white;
  margin-left: 1em;
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 2.2em;
  width: 2.2em;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.6em 0.2em #fff;
  right: 0.3em;
  transition: all 0.3s;
}

.cssbuttons-io-button:hover .icon {
  width: calc(100% - 0.6em);
}

.cssbuttons-io-button .icon svg {
  width: 1.1em;
  transition: transform 0.3s;
  color: #630ae9;
}

.cssbuttons-io-button:hover .icon svg {
  transform: translateX(0.1em);
}

.cssbuttons-io-button:active .icon {
  transform: scale(0.95);
}
/* .custom-button {
  position: relative;
  overflow: hidden;
  background: #A370F0;
  color: white;
  font-family: inherit;
  padding: 0.35em;
  padding-left: 1.2em;
  font-size: 17px;
  font-weight: 500;
  border-radius: 0.9em;
  border: none;
  letter-spacing: 0.05em;
  display: flex;
  align-items: center;
  box-shadow: inset 0 0 1.6em -0.6em #714da6;
  height: 2.8em;
  padding-right: 3.3em;
  cursor: pointer;
}

.custom-button::before {
  content: "";
  position: absolute;
  right: 0.3em;
  top: 0.3em;
  height: calc(100% - 0.6em);
  width: 2.2em;
  background: white;
  border-radius: 0.7em;
  box-shadow: 0.1em 0.1em 0.6em 0.2em #7b52b9;
  transition: width 0.3s;
}

.custom-button:hover::before {
  width: calc(100% - 0.6em);
}

.custom-button svg {
  width: 1.1em;
  transition: transform 0.3s;
  color: #7b52b9;
}

.custom-button:hover svg {
  transform: translateX(0.1em);
}

.custom-button:active {
  transform: scale(0.95);
} */
      </style>

 <style>
  .button {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 15px 20px;
  background-color: #f0c14b;
  border: none;
  font: inherit;
  color: #fff;
  font-size: 14px;
  font-weight: 400;
  border-radius: 7px;
  cursor: not-allowed;
  overflow: hidden;
  height: 35px;
  transition: all 0.3s ease cubic-bezier(0.23, 1, 0.320, 1);
}

.button span {
  position: relative;
  z-index: 2;
  display: flex;
  align-items: center;
}

.button::before {
  position: absolute;
  content: '';
  width: 100%;
  height: 100%;
  translate: 0 105%;
  background-color: #f0c14b;
  color: black;
  transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
}

.button svg {
  width: 25px;
  height: 25px;
  fill: #000;
  padding-left: 5px;
  margin-right: 5px;
  transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
}

.button:hover {
  animation: shake 0.2s linear 1;
}

.button:hover::before {
  translate: 0 0;
}

.button:hover svg {
  fill: black;
}

@keyframes shake {
  0% {
    rotate: 0deg;
  }

  33% {
    rotate: 10deg;
  }

  66% {
    rotate: -10deg;
  }

  100% {
    rotate: 10deg;
  }
}

@media (max-width: 576px) {
  #empty-cart {
      margin-left: 100px/* Adjust the margin-left value for small screens */;
      margin-top: 50px/* Adjust the margin-top value for small screens */;
    }
  }

  @media (min-width: 577px) and (max-width: 768px) {
    #empty-cart {
      margin-left:200px /* Adjust the margin-left value for medium screens */;
      margin-top:80px /* Adjust the margin-top value for medium screens */;
    }
  }
  @media(min-width:769px){
    #empty-cart{
      margin-left:360px;
      margin-top: 100px;
    }
  }
 </style>
      <body>
        <div class="container">
          <div class="row">
            <div class="col-md-9">
              <div class="step-container d-flex justify-content-between align-items-center mb-4">
                <div class="step-item active" style="color: #fcb20a;">
                  <div class="step-circle motion-effect">
                    <i class="fas fa-shopping-cart"></i>
                  </div>
                  <span class="step-heading">Shopping Cart</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                  <div class="step-circle">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <span class="step-heading">Checkout</span>
                </div>
                <div class="step-line"></div>
                <div class="step-item">
                  <div class="step-circle">
                    <i class="fas fa-truck"></i>
                  </div>
                  <span class="step-heading">Order Complete</span>
                </div>
              </div>
              <div class="table-responsive">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Product Details</th>
                      <th scope="col">Price</th>
                      <th scope="col">Quantity</th>
                      <th scope="col">Size</th>
                      <th scope="col">Color</th>
                      <th scope="col">Product Total</th>
                      <th scope="col">Action</th>
                      <th scope="col">Action</th>
                    </tr>
                  </thead>
                  <tbody>


                    <% for (let i = 0; i <products.length; i++) { %>
                    <tr>
                      <td>
                        <div class="d-flex align-items-center">
                          <img src="/public/adminimage/<%= products[i].image %>" alt="Product Image" class="mr-3" style="max-width: 100px; height: auto; border-radius: 5px;">
                          <div>
                            <h4 class="cart-item-title"><%= products[i].modelName %></h4>
                            <p><%= products[i].description %></p>
                          </div>
                        </div>
                      </td>
                      <td>
                        <span class="product-price">&#8377;<%= products[i].price %></span>
                      </td>
                      <td>
                        <span class="product-price" id="displayQuantity-<%=i%>"> <%= products[i].quantity %></span>
                      </td>

                      <td><%= products[i].size %></td>
                      <td><%= products[i].color %></td>
                      <td>
                        <span class="product-total" id="product-total-<%=i%>">&#8377;<%= products[i].total %></span>
                      </td>
                      <td>
                        <div class="quantity">
                          <button class="quantity-btn" onclick="decreaseQuantity(<%= i %>,'<%=products[i].size%>','<%=products[i].color%>','<%=products[i].stock%>')">-</button>
                          <span class="product-quantity" id="quantity-<%= i %>"><%= products[i].quantity %></span>
                          <button class="quantity-btn" onclick="increaseQuantity(<%= i %>,'<%=products[i].size%>','<%=products[i].color%>','<%=products[i].stock%>')">+</button>
                        </div>
                        <div class="message" id="message-<%= i %>"></div>
                      </td>
                      <td>
                        <button class="remove-btn button">
                          <a href="/removeitem?index=<%= i %>" style="text-decoration: none; color: inherit;" onclick="confirmDelete(event,'<%=i%>')">  <span>
                          </span>
                          <span>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-miterlimit="2" stroke-linejoin="round" fill-rule="evenodd" clip-rule="evenodd"><path fill-rule="nonzero" d="m12.002 2.005c5.518 0 9.998 4.48 9.998 9.997 0 5.518-4.48 9.998-9.998 9.998-5.517 0-9.997-4.48-9.997-9.998 0-5.517 4.48-9.997 9.997-9.997zm0 1.5c-4.69 0-8.497 3.807-8.497 8.497s3.807 8.498 8.497 8.498 8.498-3.808 8.498-8.498-3.808-8.497-8.498-8.497zm0 7.425 2.717-2.718c.146-.146.339-.219.531-.219.404 0 .75.325.75.75 0 .193-.073.384-.219.531l-2.717 2.717 2.727 2.728c.147.147.22.339.22.531 0 .427-.349.75-.75.75-.192 0-.384-.073-.53-.219l-2.729-2.728-2.728 2.728c-.146.146-.338.219-.53.219-.401 0-.751-.323-.751-.75 0-.192.073-.384.22-.531l2.728-2.728-2.722-2.722c-.146-.147-.219-.338-.219-.531 0-.425.346-.749.75-.749.192 0 .385.073.531.219z"></path></svg>
                          </span></a>

                        </button>
                      </td>
                    </tr>
                    <% } %>
                  </tbody>
                </table>
                <% if(products.length==0){%>

                <div id="empty-cart">
                  <img src="/public/userImage/lidl-romania-lidl.gif" alt="">
                </div>

                <%}%>
              </div>
            </div>
            <% if (products.length!=0){%>
                <div class="col-md-3">
                  <div class="total-container">
                    <h2 class="invoice-heading">Invoice Details</h2>
                    <div class="invoice-details">
                      <span>Subtotal:</span>
                      <span id="subTotal">&#8377; <%= total %></span>
                    </div>
                 
                    <div class="invoice-details">
                      <span >Discounts:</span>
                      <span id="discount">&#8377; <%= discount %></span>
                    </div>
                    <div class="invoice-details">
                      <span >Shipping:</span>
                      <span id="shipping">&#8377; <%= shipping %></span>

                    </div>
                    <%if((total)<2000){%>
                    <p id="message" style="font-size: x-small; color: rgb(68, 124, 209);">purchase for more than <span style="color: rgb(243, 35, 35);"> &#8377;1999 </span> for free delivery</p>
                    <% }%>
                    <hr>
                    <div class="invoice-details">
                      <span>Total: </span>
                      <span id="grandTotal">&#8377; <%=discountTotal+shipping %></span>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="text-right">
                      <form action="/buyfromcart" method="post">
                        <input type="hidden" name="total" id="totalInput">
                        <!-- <input type="hidden" name="shipping" value="<%= shipping %>"> -->
  
                        <input type="text" name="couponDiscount" id="couponDiscount" hidden>
                        <input type="text" name="otherDiscount" id="otherDiscount" hidden>
                        <!-- <input type="submit" value="Proceed to Checkout" class="btn btn-primary custom-button"> -->
                        <button type="submit" class="cssbuttons-io-button">
                          Checkout
                          <div class="icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                              <path fill="none" d="M0 0h24v24H0z"></path>
                              <path fill="currentColor" d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"></path>
                            </svg>
                          </div>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
                
              </div>
                


              <div class="row mt-4">
    
                 
              </div> <%  }%>
            </div>





           
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.7.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="https://kit.fontawesome.com/your-font-awesome-kit.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.1.5/dist/sweetalert2.all.min.js"></script>
            
            <script>
              function decreaseQuantity(i, size, color, stock) {
                
                var quantityElement = $('#quantity-' + i);
                var quantity = parseInt(quantityElement.text());
            
                // Decrease the quantity by 1
                if (quantity > 1) {
                  quantity -= 1;
                  quantityElement.text(quantity);
                  if(quantity<=stock){

                    $('#message-' + i).text('');
                  }
                  // Send AJAX request to update the quantity on the server
                  updateQuantity(quantity, i, size, color);
                }
              }

              function increaseQuantity(i, size, color, stock) {
                var quantityElement = $('#quantity-' + i);
                var quantity = parseInt(quantityElement.text());
              // if(quantity<=stock){
                quantity += 1;
                quantityElement.text(quantity);
                if(quantity<stock){

                  updateQuantity(quantity, i, size, color);
                }
              // }
                // Increase the quantity by 1
                
                if (quantity > stock) {
                  // Show message below the buttons
                  $('#message-' + i).text('Exceeded the stock limit');
                  return; // Exit the function
                }
                // Send AJAX request to update the quantity on the server
              }



              function updateQuantity(quantity, i, size, color) {
                // console.log('hai: ', quantity, i)
                var size = size
                var color = color

                $.ajax({
                  url: '/updateitem', // Replace with your actual URL
                  method: 'POST', // or 'GET' depending on your server configuration

                  data: {
                    quantity: quantity,
                    productId: i,
                    size: size,
                    color: color
                  },
                  success: function(response) {
                    // window.location.reload()
                    const quantity=$('#displayQuantity-'+i)
                    quantity.text(response.displayQuantity)
                    const productTotal=$('#product-total-'+i)
                    productTotal.text('₹' +response.total)
                    const subTotal=$('#subTotal')
                    subTotal.text('₹' +response.subTotal)
                    const grandTotal=$('#grandTotal')
                    grandTotal.text('₹' +response.grandTotal)
                    const discount=$('#discount')
                    discount.text('₹' +(response.discount))
                    if(response.subTotal>=2000){
                      document.getElementById("message").style.display = "none";
                      const shipping=$('#shipping')
                      shipping.text('₹' +0)
                    }else{
                      document.getElementById("message").style.display = "block"
                    }
                 
                    console.log('Quantity updated successfully');

                  },
                  error: function(xhr, status, error) {
                    // Handle error response
                    console.error('Failed to update quantity');
                  }

                });
              }


              var isCouponApplied = false;

              



              function confirmDelete(event,index) {
    event.preventDefault(); // Prevents the default behavior of the link

    // Display the confirmation SweetAlert
    Swal.fire({
      title: "Confirmation",
      text: "Are you sure you want to remove this item from the cart?",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Yes, remove it!",
      cancelButtonText: "No, cancel",
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        // If confirmed, proceed with the deletion by redirecting to the link
        window.location.href =`/removeitem/?index=${index}` ;
      }
    });

    return false; // Prevents the link from navigating immediately
  }
            </script>




      </body>

      </html>